################
# SSL/TLS enabled Docker Compose file for testing
#
# This compose file runs Unmanic with HTTPS enabled using local test certificates.
#
# Usage from project root:
#   docker-compose -f docker/docker-compose-ssl.yml up
#

version: '2'

services:
  unmanic-ssl-test:
    container_name: unmanic-ssl-test
    image: unmanic-ssl:test
    ports:
      - 8888:8888
    environment:
      - PUID=1000
      - PGID=1000
      # SSL/TLS Configuration
      - ssl_enabled=true
      - ssl_certfilepath=/etc/ssl/unmanic/cert.pem
      - ssl_keyfilepath=/etc/ssl/unmanic/key.pem
      # Standard Unmanic Configuration
      - DEBUGGING=true
      - TZ=America/Edmonton
    volumes:
      # Config and data directories
      - ../dev_environment/config:/config
      - ../dev_environment/cache:/tmp/unmanic
      - ../dev_environment/library:/library
      # SSL test certificates
      # Commands to generate: 
      # openssl req -x509 -newkey rsa:4096 \
      #   -keyout docker/test-key.pem \
      #   -out docker/test-cert.pem \
      #   -days 10950 -nodes \
      #   -subj "/C=XX/ST=Test/L=Test/O=Test/CN=localhost"
      #
      #  openssl req -x509 -newkey rsa:4096 \
      #   -keyout /path/to/test-key.pem \
      #   -out /path/to/test-cert.pem \
      #   -days 10950 -nodes \
      #   -subj "/C=XX/ST=Test/L=Test/O=Test/CN=localhost"
      - ./test-cert.pem:/etc/ssl/unmanic/cert.pem:ro
      - ./test-key.pem:/etc/ssl/unmanic/key.pem:ro
